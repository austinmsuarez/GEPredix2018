#!/bin/bash
set -x
set -e 

mkdir -p target
cp images/pages.jpg target
cp images/javadoc.png target

git branch
git checkout gh-pages
git pull origin gh-pages

mkdir -p images
cp target/pages.jpg images
cp target/javadoc.png images

mkdir -p javadocs
if [[ -e target ]]; then 
  rm -rf javadocs/*
  if [ -e target/apidocs ]; then
    cp -R target/apidocs/* javadocs
    find javadocs -type f -exec sed -i -e 's/-SNAPSHOT//g' {} \;
  fi
fi

for d in */; do
  # Will print */ if no directories are available
  echo "$d"
  cd $d
  if [[ -e target ]]; then 
    mkdir -p ../javadocs/$d
    rm -rf ../javadocs/$d/*
    if [ -e target/apidocs ]; then
      cp -R target/apidocs/* ../javadocs/$d
      find ../javadocs/$d -type f -exec sed -i -e 's/-SNAPSHOT//g' {} \;
    fi
  fi
  cd ..
done
    
git status
git add javadocs
git add images
git status
git commit -m 'update javadocs'
cat .git/config
git push -u origin gh-pages
git status

git checkout master

echo "************************DEVELOPER NOTE*******************************************"
echo "Have you compared application.properties to application-template.properties?"
echo "Have you compared manifest.yml to manifest.yml.template?"
echo "*********************************************************************************"
    
